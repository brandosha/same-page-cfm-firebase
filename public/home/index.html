<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/6.3.5/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/6.3.5/firebase-auth.js"></script>
    <script defer src="/__/firebase/6.3.5/firebase-firestore.js"></script>
    <script defer src="/__/firebase/6.3.5/firebase-functions.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
    
    <script src="/resources/consoleReplace.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="/resources/loader.js"></script>
    <script src="/resources/FirebaseHandler.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/resources/loader.css">
    <link rel="stylesheet" href="style.css">
</head>
  <body>
    <div id="vue-main" class="container-fluid p-0">
      <div class="row" v-if='!noGroups'>
        <div class="col-sm-4 pr-0 border-right border-dark" :class="{ 'd-none d-sm-block': isValidGroup }">
          <div v-for="(group, id) in firebaseData.groups">
            <a class="btn w-100 border-bottom group-btn px-3 py-1" :class="groupId === id ? 'btn-light' : 'btn-dark'" :href="'#'+id">
              <span class="h5 text-capitalize">{{ group.name }}</span>
              <div class="text-truncate">{{ lastMessage(id) }}</div>
            </a>
          </div>
        </div>
        <div class="col-sm-8" v-if="isValidGroup">
          <div id="messages" class="container">
            <nav id="group-toolbar" class="d-flex p-1 align-items-center justify-content-between">
              <div>
                <a class="nav-link text-dark h5 m-0 d-xs-block d-sm-none" href="#">
                  &#9664;
                </a>
              </div>
              <div class="text-dark h5 m-0 d-xs-block d-sm-none text-capitalize">
                {{ firebaseData.groups[groupId].name }}
              </div>
              <div class="dropdown">
                <a class="nav-link text-dark h4 m-0" data-toggle="dropdown" href="#" @click.prevent>&#8943;</a>
                <div class="dropdown-menu">
                  <a class="dropdown-item" href="#">Group members</a>
                  <a class="dropdown-item" href="/create-group">Create group</a>
                  <a class="dropdown-item" href="/sign-out">Sign out</a>
                </div>
              </div>
            </nav>
            <div v-for="message in firebaseData.groups[groupId].messagesArr" v-if="message !== undefined">
              <span class="text-capitalize">{{ firebaseData.users[message.from].name }}</span>: {{ message.text }}
            </div>
          </div>
          <div id="message-input">
            <form @submit.prevent="sendMessage" class="container-fluid">
              <div class="row form-group">
                <input type="text" v-model="newMessage" class="form-control mx-3 col">
                <input type="submit" value="Send" class="btn btn-primary mx-2 col-auto">
              </div>
            </form>
          </div>
        </div>
        <div class="col-sm-8 d-none d-sm-block" v-else>
          Select a group
        </div>
      </div>
      <div class='container' v-else>
        <div class="pt-3">
          <div class="display-4">It looks like you aren't a member of any groups.</div>
          <div class="lead mt-3">Join a group with a link or <a href="/create-group">create your own.</a></div>
        </div>
      </div>
    </div>

    <div id="debug">
      <div v-if="debugging" id="debug-body">
        <div id="debug-top" class="w-100 bg-light">
          <div id="debug-resize-control" class="w-100 d-flex justify-content-center align-items-center" style="height: 8px; background-color: gray">
            <div style="height: 2px; width: 30px; background-color: black"></div>
          </div>
          <form @submit.prevent='execute' class="container-fluid mt-2">
            <div class="row form-group">
              <input type="text" v-model="command" class="form-control text-monospace mx-2 col">
              <input type="submit" value="Execute" class="btn btn-primary mx-2 col-auto">
            </div>
          </form>
        </div>
        
        <div class="text-monospace border-bottom px-2" v-for="log in logs" :class="log.type">
          <pre class="d-inline">{{ log.text }}</pre>
        </div>
      </div>
    </div>

    <div id="loader" class="full-page-container">
      <div class="loader-container">
        <div class="d5"></div>
        <div class="d4"></div>
        <div class="d3"></div>
        <div class="d2"></div>
        <div class="d1"></div>
      </div>
    </div>

    <script defer src="main.js"></script>
  </body>
</html>
